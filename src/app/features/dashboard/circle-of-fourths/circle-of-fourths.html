<div class="practice-container">
  <!-- Circle Section (Left) -->
  <div class="circle-section">
    <svg class="circle-svg" viewBox="0 0 500 500">
      <!-- Outer circle (major keys) -->
      <circle
        cx="250"
        cy="250"
        r="230"
        fill="none"
        stroke="rgba(87, 83, 78, 0.3)"
        stroke-width="2"
      />
      <circle
        cx="250"
        cy="250"
        r="170"
        fill="none"
        stroke="rgba(87, 83, 78, 0.3)"
        stroke-width="2"
      />

      <!-- Key segments -->
      @for (key of keys(); track key.id) {
      <g
        class="key-segment"
        [class.selected]="key.id === selectedKey()"
        (click)="selectKey(key.id)"
      >
        <!-- Outer segment (major) -->
        <path
          [attr.d]="
            'M 250 250 L ' +
            (250 + 230 * Math.sin((key.angle * Math.PI) / 180)) +
            ' ' +
            (250 - 230 * Math.cos((key.angle * Math.PI) / 180)) +
            ' A 230 230 0 0 1 ' +
            (250 + 230 * Math.sin(((key.angle + 30) * Math.PI) / 180)) +
            ' ' +
            (250 - 230 * Math.cos(((key.angle + 30) * Math.PI) / 180)) +
            ' Z'
          "
          [attr.fill]="
            key.id === selectedKey() ? 'rgba(238, 152, 0, 0.3)' : 'rgba(44, 41, 38, 0.5)'
          "
          stroke="rgba(87, 83, 78, 0.4)"
          stroke-width="1.5"
        />

        <!-- Major key label -->
        <text
          [attr.x]="250 + 200 * Math.sin(((key.angle + 15) * Math.PI) / 180)"
          [attr.y]="250 - 200 * Math.cos(((key.angle + 15) * Math.PI) / 180)"
          text-anchor="middle"
          dominant-baseline="middle"
          class="key-label major"
        >
          {{ key.name }}
        </text>

        <!-- Minor key label (inner) -->
        <text
          [attr.x]="250 + 150 * Math.sin(((key.angle + 15) * Math.PI) / 180)"
          [attr.y]="250 - 150 * Math.cos(((key.angle + 15) * Math.PI) / 180)"
          text-anchor="middle"
          dominant-baseline="middle"
          class="key-label minor"
        >
          {{ key.minor.split(' ')[0] }}
        </text>
      </g>
      }

      <!-- Center circle -->
      <circle
        cx="250"
        cy="250"
        r="130"
        fill="rgba(26, 25, 23, 0.95)"
        stroke="rgba(238, 152, 0, 0.5)"
        stroke-width="3"
      />
      <text x="250" y="235" text-anchor="middle" class="center-label">{{ currentKey().name }}</text>
      <text x="250" y="260" text-anchor="middle" class="center-sublabel">
        {{ currentKey().major }}
      </text>
    </svg>
  </div>

  <!-- Exercise Panel (Right) -->
  <div class="exercise-panel">
    <!-- Exercise Selector -->
    <div class="exercise-header">
      <mat-form-field appearance="outline">
        <mat-select [value]="currentExercise()" (selectionChange)="changeExercise($event.value)">
          @for (ex of exercises(); track ex.id) {
          <mat-option [value]="ex.id">{{ ex.name }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Exercise Instructions -->
    <div class="exercise-instructions">
      <p>{{ currentExerciseInfo()?.description }}</p>
    </div>

    <!-- Exercise Controls (vary by type) -->
    <div class="exercise-controls">
      @switch (currentExercise()) { @case ('scale-patterns') {
      <div class="control-group">
        <label>Octave Pattern</label>
        <div class="button-group">
          <button
            mat-stroked-button
            [class.active]="octavePattern() === 1"
            (click)="octavePattern.set(1)"
          >
            1 Octave
          </button>
          <button
            mat-stroked-button
            [class.active]="octavePattern() === 2"
            (click)="octavePattern.set(2)"
          >
            2 Octaves
          </button>
        </div>
      </div>
      } @case ('interval-practice') {
      <div class="control-group">
        <label>Interval Type</label>
        <div class="button-group">
          <button
            mat-stroked-button
            [class.active]="intervalType() === 'roots'"
            (click)="intervalType.set('roots')"
          >
            Roots
          </button>
          <button
            mat-stroked-button
            [class.active]="intervalType() === '3rds'"
            (click)="intervalType.set('3rds')"
          >
            3rds
          </button>
          <button
            mat-stroked-button
            [class.active]="intervalType() === '5ths'"
            (click)="intervalType.set('5ths')"
          >
            5ths
          </button>
          <button
            mat-stroked-button
            [class.active]="intervalType() === 'triads'"
            (click)="intervalType.set('triads')"
          >
            Triads
          </button>
        </div>
      </div>
      } @case ('chord-tones') {
      <div class="chord-progression">
        <div class="chord-display">
          <span class="chord">Cmaj</span>
          <span class="chord">Fmaj</span>
          <span class="chord">G7</span>
          <span class="chord">Cmaj</span>
        </div>
      </div>
      } }
    </div>

    <!-- Key Information -->
    <div class="key-info">
      <div class="info-row">
        <span class="label">Key Signature</span>
        <span class="value">
          {{ currentKey().name }}
        </span>
      </div>
      <div class="info-row">
        <span class="label">4th Up</span>
        <span class="value">{{ relatedKeys().fourthUp.name }}</span>
      </div>
      <div class="info-row">
        <span class="label">4th Down</span>
        <span class="value">{{ relatedKeys().fourthDown.name }}</span>
      </div>
      <div class="info-row">
        <span class="label">Relative Minor</span>
        <span class="value">{{ relatedKeys().relativeMinor }}</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button mat-flat-button color="primary" (click)="startExercise()">
        <mat-icon>play_arrow</mat-icon>
        Start
      </button>
    </div>
  </div>
</div>
