<mat-toolbar class="main-toolbar">
  <div class="toolbar-start">
    <div class="logo-module">
      <div class="audio-spectrum">
        @for (level of audioLevels(); track $index) {
        <div class="bar" [class.active]="level > 12" [style.height.%]="level"></div>
        }
        <div class="logo-text">BASSIO</div>
      </div>
      <div class="rack-light" [class.connected]="isAudioConnected()"></div>
    </div>
  </div>

  <div class="toolbar-center">
    <div class="tuner-module" [class.active]="tunerActive()">
      <div class="tuner-display">
        @if (tunerActive()) {
        <div class="display-on">
          <div class="note">{{ currentNote() }}</div>
          <div class="meter">
            <div class="track"></div>
            <div class="needle" [style.left.%]="needlePosition()"></div>
          </div>
          <div class="cents">{{ centsDiff() > 0 ? '+' : '' }}{{ centsDiff().toFixed(0) }}Â¢</div>
        </div>
        } @else {
        <div class="display-off">OFF</div>
        }
      </div>
      <button class="power-btn" (click)="toggleTuner()" [class.on]="tunerActive()">
        <span class="toggle"></span>
      </button>
    </div>
  </div>

  <div class="metronome-module" [class.active]="metronomeActive()" [class.locked]="bpmLocked()">
    <div class="bpm-display">
      <input
        class="bpm-input"
        [value]="tempo.bpm()"
        [disabled]="bpmLocked()"
        (input)="onBpmInput($event)"
        (keydown.enter)="$event.target.blur()"
        min="40"
        max="240"
      />
      <span class="bpm-label">BPM</span>
    </div>
    <div class="bpm-controls">
      <button class="bpm-btn" (click)="adjustBpm(1)" [disabled]="bpmLocked()">
        <mat-icon>keyboard_arrow_up</mat-icon>
      </button>
      <button class="bpm-btn" (click)="adjustBpm(-1)" [disabled]="bpmLocked()">
        <mat-icon>keyboard_arrow_down</mat-icon>
      </button>
    </div>
    <button class="power-btn" (click)="toggleMetronome()" [class.on]="metronomeActive()">
      <span class="toggle"></span>
    </button>
  </div>

  <div class="toolbar-end">
    <a routerLink="/dashboard"><button mat-button class="toolbar-btn">Learn</button></a>
    <button mat-button class="toolbar-btn" [matMenuTriggerFor]="menu">Practice</button>
    <mat-menu #menu="matMenu" id="menu">
      <a routerLink="/circle-of-fourths"><button mat-menu-item>Circle of Fourths</button></a>
    </mat-menu>

    <button class="avatar-btn" (click)="onUserClick()">
      {{ userName().charAt(0) }}
    </button>
  </div>
</mat-toolbar>
